<div class="container">
  <!-- Header -->
  <div class="header">
    <h1>GestiÃ³n de MembresÃ­as de Clientes</h1>
    <div class="header-actions">
      <button class="btn btn-primary" (click)="abrirDialogoAsignar()">
        <span class="icon">â•</span>
        Asignar MembresÃ­a
      </button>
      <button class="btn btn-secondary" (click)="cargarMembresiasPorExpirar()">
        <span class="icon">âš ï¸</span>
        Por Expirar
      </button>
      <button class="btn btn-secondary" (click)="verEstadisticas()">
        <span class="icon">ğŸ“Š</span>
        EstadÃ­sticas
      </button>
    </div>
  </div>

  <!-- Filtros -->
  <div class="filtros-container">
    <div class="filtro-group">
      <input 
        type="text" 
        [(ngModel)]="filtro" 
        (input)="aplicarFiltro()"
        placeholder="Buscar por folio, tipo o estatus..."
        class="filtro-input">
      <button class="btn btn-clear" (click)="limpiarFiltro()">
        <span class="icon">ğŸ—‘ï¸</span>
        Limpiar
      </button>
    </div>
  </div>

  <!-- MÃ©tricas RÃ¡pidas -->
  <div class="metricas-container">
    <div class="metrica-card">
      <div class="metrica-icon">ğŸ‘¥</div>
      <div class="metrica-info">
        <div class="metrica-valor">{{ membresias.length }}</div>
        <div class="metrica-label">Total MembresÃ­as</div>
      </div>
    </div>
    <div class="metrica-card">
      <div class="metrica-icon">âœ…</div>
      <div class="metrica-info">
        <div class="metrica-valor">{{ calcularTotalActivas() }}</div>
        <div class="metrica-label">Activas</div>
      </div>
    </div>
    <div class="metrica-card">
      <div class="metrica-icon">â°</div>
      <div class="metrica-info">
        <div class="metrica-valor">{{ calcularPorExpirar() }}</div>
        <div class="metrica-label">Por Expirar</div>
      </div>
    </div>
    <div class="metrica-card">
      <div class="metrica-icon">ğŸ”„</div>
      <div class="metrica-info">
        <div class="metrica-valor">{{ calcularTasaRenovacion() }}%</div>
        <div class="metrica-label">Tasa RenovaciÃ³n</div>
      </div>
    </div>
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="loading">
    <div class="spinner"></div>
    <p>Cargando membresÃ­as...</p>
  </div>

  <!-- Table -->
  <div *ngIf="!loading && membresiasFiltradas.length > 0" class="table-container">
    <table class="data-table">
      <thead>
        <tr class="header-row">
          <th>Folio Cliente</th>
          <th>Tipo MembresÃ­a</th>
          <th>Vigencia</th>
          <th>Estatus</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let membresia of membresiasFiltradas" class="data-row">
          <td class="folio-cell">
            <span class="client-icon">ğŸ‘¤</span>
            {{ membresia.folio_cliente }}
          </td>
          <td class="membresia-cell">
            <span [class]="'badge ' + obtenerClaseMembresia(membresia.id_membresia)">
              {{ obtenerEtiquetaMembresia(membresia.id_membresia) }}
            </span>
          </td>
          <td class="fechas-cell">
            <div class="fecha-item">
              <span class="fecha-icon">ğŸ“…</span>
              <div class="fecha-info">
                <span class="fecha-label">Inicio:</span>
                <span class="fecha-value">{{ formatearFecha(membresia.fecha_inicio) }}</span>
              </div>
            </div>
            <div class="fecha-item">
              <span class="fecha-icon">â°</span>
              <div class="fecha-info">
                <span class="fecha-label">Fin:</span>
                <span class="fecha-value">{{ formatearFecha(membresia.fecha_fin) }}</span>
              </div>
            </div>
          </td>
          <td>
            <span [class]="'estatus-chip ' + obtenerClaseEstatus(membresia.estatus)">
              <span class="chip-icon">{{ obtenerIconoEstatus(membresia.estatus) }}</span>
              {{ membresia.estatus }}
            </span>
          </td>
          <td class="actions-cell">
            <div class="actions-container">
              <button class="btn-icon btn-primary" 
                      (click)="renovarMembresia(membresia)"
                      title="Renovar membresÃ­a">
                <span>ğŸ”„</span>
              </button>
              
              <button class="btn-icon btn-warn" 
                      (click)="cancelarMembresia(membresia)"
                      title="Cancelar membresÃ­a"
                      [disabled]="membresia.estatus === 'Cancelada'">
                <span>âŒ</span>
              </button>
              
              <button class="btn-icon btn-accent" 
                      (click)="verificarAcceso(membresia)"
                      title="Verificar acceso">
                <span>âœ…</span>
              </button>
              
              <button class="btn-icon btn-basic" 
                      (click)="verHistorial(membresia)"
                      title="Ver historial">
                <span>ğŸ“‹</span>
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Empty State -->
  <div *ngIf="!loading && membresiasFiltradas.length === 0" class="empty-state">
    <div class="empty-content">
      <span class="empty-icon">ğŸ‘¥</span>
      <h3>No hay membresÃ­as registradas</h3>
      <p>Comienza asignando una nueva membresÃ­a a un cliente.</p>
      <button class="btn btn-primary" (click)="abrirDialogoAsignar()">
        <span class="icon">â•</span>
        Asignar Primera MembresÃ­a
      </button>
    </div>
  </div>

  <!-- DiÃ¡logo para asignar membresÃ­a -->
  <div *ngIf="showAsignarDialog" class="dialog-overlay">
    <div class="dialog">
      <div class="dialog-header">
        <h2>Asignar Nueva MembresÃ­a</h2>
        <button class="close-btn" (click)="showAsignarDialog = false">Ã—</button>
      </div>
      
      <div class="dialog-content">
        <form (ngSubmit)="asignarMembresia()" #asignarForm="ngForm" class="form-container">
          <div class="form-group">
            <label for="folioCliente">Folio Cliente *</label>
            <input type="text" 
                   id="folioCliente"
                   [(ngModel)]="asignarFormData.folioCliente" 
                   name="folioCliente" 
                   required
                   placeholder="Ingresa el folio del cliente"
                   class="form-control">
          </div>

          <div class="form-group">
            <label for="idMembresia">Tipo de MembresÃ­a *</label>
            <select [(ngModel)]="asignarFormData.idMembresia" name="idMembresia" required class="form-control">
              <option *ngFor="let tipo of tipoMembresias" [value]="tipo.value">
                {{ tipo.label }}
              </option>
            </select>
          </div>

          <div class="form-group">
            <label for="fechaInicio">Fecha Inicio *</label>
            <input type="date" 
                   id="fechaInicio"
                   [(ngModel)]="asignarFormData.fechaInicio" 
                   name="fechaInicio" 
                   required
                   class="form-control">
          </div>

          <div class="form-info">
            <span class="info-icon">â„¹ï¸</span>
            <span>La membresÃ­a se asignarÃ¡ con vigencia segÃºn el tipo seleccionado</span>
          </div>
        </form>
      </div>

      <div class="dialog-actions">
        <button class="btn btn-cancel" 
                type="button" 
                (click)="showAsignarDialog = false">
          Cancelar
        </button>
        <button class="btn btn-primary" 
                type="button"
                (click)="asignarMembresia()"
                [disabled]="!asignarForm.form.valid || loading">
          <span *ngIf="!loading">âœ“</span>
          <span *ngIf="loading" class="spinner-small"></span>
          {{ loading ? 'Asignando...' : 'Asignar MembresÃ­a' }}
        </button>
      </div>
    </div>
  </div>

  <!-- Snackbar -->
  <div *ngIf="snackbar.show" 
       class="snackbar" 
       [class.snackbar-success]="snackbar.type === 'success'"
       [class.snackbar-error]="snackbar.type === 'error'">
    <div class="snackbar-content">
      <span class="snackbar-icon">
        {{ snackbar.type === 'success' ? 'âœ…' : 'âŒ' }}
      </span>
      <span class="snackbar-message">{{ snackbar.message }}</span>
    </div>
    <button class="snackbar-close" (click)="cerrarSnackbar()">
      Ã—
    </button>
  </div>
</div>