<div class="container mt-4">
  <div class="row">
    <div class="col-12">
      <h2>Gestión de Membresías</h2>
      
      <!-- Estadísticas -->
      <div class="row mb-4">
        <div class="col-md-4">
          <div class="card text-white bg-primary">
            <div class="card-body text-center">
              <h5 class="card-title">Total</h5>
              <p class="card-text display-4">{{ estadisticas.totalMembresias || 0 }}</p>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card text-white bg-success">
            <div class="card-body text-center">
              <h5 class="card-title">Activas</h5>
              <p class="card-text display-4">{{ estadisticas.membresiasActivas || 0 }}</p>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card text-white bg-warning">
            <div class="card-body text-center">
              <h5 class="card-title">Inactivas</h5>
              <p class="card-text display-4">{{ estadisticas.membresiasInactivas || 0 }}</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Filtros y Acciones -->
      <div class="row mb-3">
        <div class="col-md-6">
          <div class="input-group">
            <input type="text" class="form-control" placeholder="Buscar por tipo, descripción, estado o ID..." 
                   [(ngModel)]="filtro" (input)="aplicarFiltro()">
            <button *ngIf="filtro" class="btn btn-outline-secondary" type="button" (click)="limpiarFiltro()">
              ✕
            </button>
          </div>
        </div>
        <div class="col-md-6 text-end">
          <button class="btn btn-success" routerLink="/membresias/nueva">
            ➕ Nueva Membresía
          </button>
        </div>
      </div>

      <!-- Loading -->
      <div *ngIf="loading" class="text-center">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Cargando...</span>
        </div>
        <p class="mt-2">Cargando membresías...</p>
      </div>

      <!-- Tabla de membresías -->
      <div *ngIf="!loading" class="table-responsive">
        <table class="table table-striped table-hover">
          <thead class="table-dark">
            <tr>
              <th>ID</th>
              <th>Tipo</th>
              <th>Precio</th>
              <th>Duración</th>
              <th>Descripción</th>
              <th>Estado</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let membresia of membresiasFiltradas">
              <td><strong>{{ membresia.idMembresia }}</strong></td>
              <td>{{ membresia.tipo }}</td>
              <td>${{ membresia.precio | number:'1.2-2' }}</td>
              <td>{{ membresia.duracion }} días</td>
              <td>{{ membresia.descripcion }}</td>
              <td>
                <span [class]="membresia.estatus === 'Activa' ? 'badge bg-success' : 'badge bg-warning'">
                  {{ membresia.estatus }}
                </span>
              </td>
              <td>
                <div class="btn-group btn-group-sm">
                  <button class="btn btn-outline-primary" 
                          [routerLink]="['/membresias/editar', membresia.idMembresia]">
                    ✏️ Editar
                  </button>
                  <button *ngIf="membresia.estatus === 'Activa'" 
                          class="btn btn-outline-warning" 
                          (click)="desactivarMembresia(membresia.idMembresia)"
                          title="Desactivar membresía">
                    ⏸️ Desactivar
                  </button>
                  <button *ngIf="membresia.estatus === 'Inactiva'" 
                          class="btn btn-outline-success" 
                          (click)="activarMembresia(membresia.idMembresia)"
                          title="Activar membresía">
                    ▶️ Activar
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Mensajes de estado -->
      <div *ngIf="!loading && membresiasFiltradas.length === 0 && membresias.length > 0" 
           class="alert alert-warning text-center">
        No se encontraron membresías que coincidan con "{{ filtro }}"
      </div>

      <div *ngIf="!loading && membresias.length === 0" 
           class="alert alert-info text-center">
        No hay membresías registradas. 
        <a routerLink="/membresias/nueva" class="alert-link">Crea la primera membresía</a>
      </div>
    </div>
  </div>
</div>