<div class="membresias-container">
  <!-- Header Mejorado con Tema Gimnasio -->
  <div class="header">
    <div class="header-content">
      <h1><i class="fas fa-id-card"></i> Gestión de Membresías</h1>
      <p class="header-subtitle">Administra y controla las membresías del gimnasio</p>
    </div>
    <div class="header-actions">
      <button class="btn btn-primary" routerLink="/membresias/nueva">
        <i class="fas fa-plus-circle"></i> Nueva Membresía
      </button>
    </div>
  </div>

  <!-- Loading Spinner Mejorado -->
  <div *ngIf="loading" class="loading-spinner">
    <div class="spinner"></div>
    <p>Cargando membresías...</p>
    <div class="loading-dots">
      <span></span>
      <span></span>
      <span></span>
    </div>
  </div>

<!-- Después del loading spinner, ANTES de la búsqueda -->

<!-- Dashboard con Métricas Mejoradas -->
<div *ngIf="!loading" class="dashboard-section">
  <div class="dashboard-header">
    <h3><i class="fas fa-chart-line"></i> Dashboard de Rendimiento</h3>
  </div>
  
  <!-- Métricas Mejoradas -->
  <div class="metrics-grid">
    <div class="metric-card">
      <div class="metric-icon total">
        <i class="fas fa-id-card-alt"></i>
      </div>
      <div class="metric-content">
        <h4>Total Membresías</h4>
        <p class="metric-number">{{ estadisticas.totalMembresias || 0 }}</p>
        <span class="metric-trend positive">
          <i class="fas fa-arrow-up"></i> {{ calcularCrecimiento() }}%
        </span>
      </div>
    </div>

    <div class="metric-card">
      <div class="metric-icon revenue">
        <i class="fas fa-dollar-sign"></i>
      </div>
      <div class="metric-content">
        <h4>Ingreso Mensual</h4>
        <p class="metric-number">${{ calcularIngresoMensual() | number:'1.0-0' }}</p>
        <span class="metric-subtitle">Proyectado</span>
      </div>
    </div>

    <div class="metric-card">
      <div class="metric-icon popular">
        <i class="fas fa-crown"></i>
      </div>
      <div class="metric-content">
        <h4>Más Popular</h4>
        <p class="metric-value">{{ obtenerMembresiaPopular() }}</p>
        <span class="metric-subtitle">{{ getPorcentajePopular() }}% del total</span>
      </div>
    </div>

    <div class="metric-card">
      <div class="metric-icon rate">
        <i class="fas fa-chart-pie"></i>
      </div>
      <div class="metric-content">
        <h4>Tasa Activas</h4>
        <p class="metric-number">{{ calcularTasaActivas() }}%</p>
        <span class="metric-trend" [class.positive]="calcularTasaActivas() > 70" 
               [class.negative]="calcularTasaActivas() <= 70">
          {{ calcularTasaActivas() > 70 ? 'Óptimo' : 'Mejorable' }}
        </span>
      </div>
    </div>
  </div>

  <!-- Gráficos -->
  <div class="charts-section" *ngIf="membresias.length > 0">
    <div class="charts-grid">
      <!-- Gráfico de Distribución -->
      <div class="chart-container">
        <div class="chart-header">
          <h4><i class="fas fa-chart-pie"></i> Distribución por Tipo</h4>
        </div>
        <div class="chart-wrapper">
          <canvas id="distribucionChart" width="400" height="300"></canvas>
        </div>
        <div class="chart-summary">
          <span *ngFor="let tipo of tiposMembresia" class="chart-tag">
            <span class="tag-color" [style.background]="getColorForTipo(tipo)"></span>
            {{ tipo }}: {{ getCountForTipo(tipo) }}
          </span>
        </div>
      </div>

      <!-- Gráfico de Ingresos -->
      <div class="chart-container">
        <div class="chart-header">
          <h4><i class="fas fa-money-bill-wave"></i> Ingresos por Tipo</h4>
        </div>
        <div class="chart-wrapper">
          <canvas id="ingresosChart" width="400" height="300"></canvas>
        </div>
        <div class="chart-summary">
          <span class="revenue-total">
            Total: ${{ calcularIngresoMensual() | number:'1.0-0' }}
          </span>
        </div>
      </div>
    </div>
  </div>
</div>



  <!-- Estadísticas Mejoradas -->
  <div *ngIf="!loading" class="stats-section">
    <div class="stats-container">
      <div class="stats-card">
        <div class="stats-icon total">
          <i class="fas fa-id-card-alt"></i>
        </div>
        <div class="stats-info">
          <h4>Total de Membresías</h4>
          <p class="stats-number">{{ estadisticas.totalMembresias || 0 }}</p>
        </div>
      </div>
      <div class="stats-card">
        <div class="stats-icon active">
          <i class="fas fa-check-circle"></i>
        </div>
        <div class="stats-info">
          <h4>Activas</h4>
          <p class="stats-number">{{ estadisticas.membresiasActivas || 0 }}</p>
        </div>
      </div>
      <div class="stats-card">
        <div class="stats-icon inactive">
          <i class="fas fa-pause-circle"></i>
        </div>
        <div class="stats-info">
          <h4>Inactivas</h4>
          <p class="stats-number">{{ estadisticas.membresiasInactivas || 0 }}</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Barra de búsqueda y filtros -->
  <div *ngIf="!loading" class="search-bar">
    <div class="search-container">
      <i class="fas fa-search search-icon"></i>
      <input
        type="text"
        class="search-input"
        placeholder="Buscar por tipo, descripción, estado o ID..."
        [(ngModel)]="filtro"
        (input)="aplicarFiltro()"
      >
      <button *ngIf="filtro" class="btn btn-clear" type="button" (click)="limpiarFiltro()">
        <i class="fas fa-times"></i>
      </button>
    </div>
  </div>

  <!-- Lista de Membresías Mejorada -->
  <div *ngIf="!loading" class="membresias-section">
    <div class="section-header">
      <h2><i class="fas fa-list"></i> Catalogo de Membresías</h2>
      <span class="membresias-count">{{ membresiasFiltradas.length }} membresía{{ membresiasFiltradas.length !== 1 ? 's' : '' }}</span>
    </div>

    <div class="membresias-list" [class.scrollable]="membresiasFiltradas.length > 3">
      <div *ngIf="membresiasFiltradas.length === 0 && membresias.length > 0" class="no-membresias">
        <div class="no-membresias-icon">
          <i class="fas fa-search"></i>
        </div>
        <h3>No se encontraron membresías</h3>
        <p>No hay membresías que coincidan con "{{ filtro }}"</p>
        <button class="btn btn-primary" (click)="limpiarFiltro()">
          <i class="fas fa-times"></i> Limpiar filtro
        </button>
      </div>

      <div *ngIf="membresias.length === 0" class="no-membresias">
        <div class="no-membresias-icon">
          <i class="fas fa-id-card"></i>
        </div>
        <h3>No hay membresías registradas</h3>
        <p>Crea la primera membresía para comenzar</p>
        <button class="btn btn-primary" routerLink="/membresias/nueva">
          <i class="fas fa-plus-circle"></i> Crear Primera Membresía
        </button>
      </div>

      <div *ngFor="let membresia of membresiasFiltradas; let i = index" class="membresia-card" [style.animation-delay]="i * 0.1 + 's'">
        <div class="membresia-header">
          <div class="membresia-title">
            <h4>{{ membresia.tipo }}</h4>
            <span [class]="'estatus-badge ' + getEstatusBadgeClass(membresia.estatus)">
              <i class="fas fa-circle"></i> {{ membresia.estatus }}
            </span>
        
        <div class="membresia-content">
          <div class="info-grid">
            <div class="info-item">
              <i class="fas fa-dollar-sign"></i>
              <div class="info-content">
                <span class="info-label">Precio</span>
                <span class="info-value">${{ membresia.precio | number:'1.2-2' }}</span>
              </div>
            </div>
            
            <div class="info-item">
              <i class="fas fa-calendar-alt"></i>
              <div class="info-content">
                <span class="info-label">Duración</span>
                <span class="info-value">{{ membresia.duracion }} días</span>
              </div>
            </div>
            
            <div class="info-item full-width">
              <i class="fas fa-align-left"></i>
              <div class="info-content">
                <span class="info-label">Descripción</span>
                <span class="info-value">{{ membresia.descripcion }}</span>
              </div>
            </div>
          </div>
        </div>

        <div class="membresia-actions">
          <button 
            class="btn btn-sm btn-warning" 
            [routerLink]="['/membresias/editar', membresia.idMembresia]"
            [disabled]="loading"
          >
            <i class="fas fa-edit"></i> Editar
          </button>
          
          <button 
            *ngIf="membresia.estatus === 'Activa'"
            class="btn btn-sm btn-danger" 
            (click)="desactivarMembresia(membresia.idMembresia)"
            [disabled]="loading"
            title="Desactivar membresía"
          >
            <i class="fas fa-pause-circle"></i> Desactivar
          </button>

          <button 
            *ngIf="membresia.estatus === 'Inactiva'"
            class="btn btn-sm btn-success" 
            (click)="activarMembresia(membresia.idMembresia)"
            [disabled]="loading"
            title="Activar membresía"
          >
            <i class="fas fa-play-circle"></i> Activar
          </button>
        </div>
      </div>
    </div>
  </div>
</div>