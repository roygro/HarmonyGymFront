<div><app-header-recepcionista></app-header-recepcionista></div>

<div class="container mt-4">
  <!-- Header estandarizado -->
  <div class="header-section">
    <div class="header-content">
      <div class="header-left">
        <h1 class="section-title">
          <i class="fas fa-history"></i>
          Historial de Pagos
        </h1>
        <p class="section-subtitle">Gestión y consulta de todos los pagos registrados</p>
      </div>
      
      <div class="header-right">
        <div class="header-actions">
          <button class="btn btn-primary" (click)="crearPago()">
            <i class="fas fa-plus-circle"></i> Nuevo Pago
          </button>
          <button class="btn btn-secondary" (click)="recargar()" [disabled]="cargando">
            <i class="fas fa-sync-alt" [class.fa-spin]="cargando"></i> Actualizar
          </button>
          <button class="btn btn-secondary" (click)="exportarPagos()">
            <i class="fas fa-file-export"></i> Exportar
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Tarjetas de estadísticas estandarizadas -->
  <div class="stats-section">
    <div class="stats-container">
      <div class="stats-card">
        <div class="stats-icon total">
          <i class="fas fa-dollar-sign"></i>
        </div>
        <div class="stats-info">
          <h4>VENTAS DEL DÍA</h4>
          <p class="stats-number">
            {{ cargandoEstadisticas ? '...' : formatearMoneda(estadisticas.totalVentas) }}
          </p>
        </div>
      </div>
      <div class="stats-card">
        <div class="stats-icon active">
          <i class="fas fa-receipt"></i>
        </div>
        <div class="stats-info">
          <h4>TRANSACCIONES HOY</h4>
          <p class="stats-number">
            {{ cargandoEstadisticas ? '...' : estadisticas.cantidadVentas }}
          </p>
        </div>
      </div>
      <div class="stats-card">
        <div class="stats-icon inactive">
          <i class="fas fa-user-friends"></i>
        </div>
        <div class="stats-info">
          <h4>CLIENTES ÚNICOS</h4>
          <p class="stats-number">
            {{ cargandoEstadisticas ? '...' : clientesUnicos }}
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- Filtros estandarizados -->
  <div class="filters-card">
    <div class="filters-header">
      <h3><i class="fas fa-filter"></i> Filtros Avanzados</h3>
    </div>
    <div class="filters-content">
      <div class="filters-grid">
        <div class="filter-group">
          <label class="filter-label">
            <i class="fas fa-user"></i> Cliente
          </label>
          <input 
            type="text" 
            class="filter-input" 
            placeholder="Ej: CLI001"
            [(ngModel)]="filtroCliente"
            (input)="aplicarFiltros()">
        </div>
        
        <div class="filter-group">
          <label class="filter-label">
            <i class="fas fa-user-tie"></i> Recepcionista
          </label>
          <input 
            type="text" 
            class="filter-input" 
            placeholder="Ej: REC001"
            [(ngModel)]="filtroRecepcionista"
            (input)="aplicarFiltros()">
        </div>
        
        <div class="filter-group">
          <label class="filter-label">
            <i class="fas fa-calendar"></i> Fecha Inicio
          </label>
          <input 
            type="date" 
            class="filter-input" 
            [(ngModel)]="filtroFechaInicio"
            (change)="aplicarFiltros()">
        </div>
        
        <div class="filter-group">
          <label class="filter-label">
            <i class="fas fa-calendar"></i> Fecha Fin
          </label>
          <input 
            type="date" 
            class="filter-input" 
            [(ngModel)]="filtroFechaFin"
            (change)="aplicarFiltros()">
        </div>
      </div>
      
      <div class="filters-actions">
        <button class="btn btn-secondary" (click)="limpiarFiltros()">
          <i class="fas fa-times"></i> Limpiar Filtros
        </button>
      </div>
      
      <div class="filters-info" *ngIf="filtroCliente || filtroRecepcionista || filtroFechaInicio || filtroFechaFin">
        <i class="fas fa-info-circle"></i>
        Mostrando {{ pagosFiltrados.length }} de {{ pagos.length }} pagos
        <span *ngIf="filtroCliente || filtroRecepcionista || filtroFechaInicio || filtroFechaFin">
          | Total filtrado: {{ formatearMoneda(totalFiltrado) }}
        </span>
      </div>
    </div>
  </div>

  <!-- Loading estandarizado -->
  <div *ngIf="cargando" class="loading-spinner">
    <div class="spinner"></div>
    <p>Cargando pagos...</p>
    <div class="loading-dots">
      <span></span>
      <span></span>
      <span></span>
    </div>
  </div>

  <!-- Error estandarizado -->
  <div *ngIf="error && !cargando" class="error-container">
    <div class="error-content">
      <i class="fas fa-exclamation-triangle error-icon"></i>
      <div class="error-text">
        <h4>Error al cargar los pagos</h4>
        <p>{{ error }}</p>
      </div>
      <button class="btn btn-primary" (click)="cargarPagos()">
        <i class="fas fa-redo"></i> Reintentar
      </button>
    </div>
  </div>

  <!-- Lista de pagos estandarizada -->
  <div *ngIf="!cargando && !error" class="pagos-section">
    <div class="section-header">
      <h2><i class="fas fa-clipboard-list"></i> Lista de Pagos</h2>
      <span class="pagos-count">{{ pagosFiltrados.length }} pago{{ pagosFiltrados.length !== 1 ? 's' : '' }}</span>
    </div>

    <div class="pagos-list">
      <div *ngIf="pagosFiltrados.length === 0" class="no-pagos">
        <div class="no-pagos-icon">
          <i class="fas fa-receipt"></i>
        </div>
        <h3>No se encontraron pagos</h3>
        <p *ngIf="filtroCliente || filtroRecepcionista || filtroFechaInicio || filtroFechaFin">
          No hay pagos que coincidan con los filtros aplicados
        </p>
        <p *ngIf="!filtroCliente && !filtroRecepcionista && !filtroFechaInicio && !filtroFechaFin">
          No hay pagos registrados en el sistema
        </p>
        <button class="btn btn-primary" (click)="crearPago()">
          <i class="fas fa-plus-circle"></i> Registrar Primer Pago
        </button>
      </div>

      <div *ngFor="let pago of pagosFiltrados; let i = index" class="pago-card" [style.animation-delay]="i * 0.1 + 's'">
        <div class="pago-header">
          <div class="pago-amount">
            <span class="amount">{{ formatearMoneda(pago.total) }}</span>
          </div>
        </div>
        
        <div class="pago-content">
          <div class="pago-info">
            <div class="info-grid">
              <div class="info-item">
                <i class="fas fa-user"></i>
                <div class="info-content">
                  <span class="info-label">Cliente</span>
                  <span class="info-value">{{ pago.folioCliente }}</span>
                </div>
              </div>
              
              <div class="info-item">
                <i class="fas fa-cube"></i>
                <div class="info-content">
                  <span class="info-label">Producto</span>
                  <span class="info-value">{{ pago.codigoProducto }}</span>
                </div>
              </div>
              
              <div class="info-item">
                <i class="fas fa-hashtag"></i>
                <div class="info-content">
                  <span class="info-label">Cantidad</span>
                  <span class="info-value">{{ pago.cantidad }}</span>
                </div>
              </div>
              
              <div class="info-item">
                <i class="fas fa-calendar-day"></i>
                <div class="info-content">
                  <span class="info-label">Fecha</span>
                  <span class="info-value">{{ formatearFecha(pago.fechaVenta!) }}</span>
                </div>
              </div>
              
              <div class="info-item">
                <i class="fas fa-user-tie"></i>
                <div class="info-content">
                  <span class="info-label">Recepcionista</span>
                  <span class="info-value">{{ pago.idRecepcionista }}</span>
                </div>
              </div>
            </div>
          </div>

          <div class="pago-actions">
            <button 
              class="btn btn-sm btn-primary"
              (click)="verDetalles(pago)"
              title="Ver detalles">
              <i class="fas fa-eye"></i> Ver Detalles
            </button>
            
            <button 
              class="btn btn-sm btn-secondary"
              (click)="descargarRecibo(pago)"
              title="Descargar recibo">
              <i class="fas fa-download"></i> Recibo PDF
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>